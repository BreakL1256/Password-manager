<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Password_manager.Templates.PasswordVaultView"
             x:Name="VaultViewRoot">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="280"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Grid Grid.Column="0" 
              BackgroundColor="{AppThemeBinding Light=#F2F2F7, Dark=#2C2C2E}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <SearchBar Grid.Row="0"
                       Placeholder="Search"
                       TextChanged="OnSearchBarTextChanged"
                       Margin="16,16,16,8"
                       BackgroundColor="Transparent"
                       TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"
                       PlaceholderColor="{AppThemeBinding Light=#8E8E93, Dark=#8E8E93}"/>

            <FlexLayout Grid.Row="1" 
                        Wrap="Wrap" 
                        JustifyContent="Start" 
                        Direction="Row" 
                        Padding="16,0,16,8">
                <Button x:Name="BtnAll" Text="All" Clicked="OnFilterAll" Padding="10,0" HeightRequest="30" FontSize="12" CornerRadius="8" Margin="0,0,6,6" BorderWidth="1" BackgroundColor="Transparent" TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"/>
                <Button x:Name="BtnGeneral" Text="General" Clicked="OnFilterGeneral" Padding="10,0" HeightRequest="30" FontSize="12" CornerRadius="8" Margin="0,0,6,6" BorderWidth="1" BackgroundColor="Transparent" TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"/>
                <Button x:Name="BtnWork" Text="Work" Clicked="OnFilterWork" Padding="10,0" HeightRequest="30" FontSize="12" CornerRadius="8" Margin="0,0,6,6" BorderWidth="1" BackgroundColor="Transparent" TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"/>
                <Button x:Name="BtnSocial" Text="Social" Clicked="OnFilterSocial" Padding="10,0" HeightRequest="30" FontSize="12" CornerRadius="8" Margin="0,0,6,6" BorderWidth="1" BackgroundColor="Transparent" TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"/>
                <Button x:Name="BtnOther" Text="Other" Clicked="OnFilterOther" Padding="10,0" HeightRequest="30" FontSize="12" CornerRadius="8" Margin="0,0,6,6" BorderWidth="1" BackgroundColor="Transparent" TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"/>
            </FlexLayout>

            <Button Grid.Row="2"
                    x:Name="AddPasswordBtn"
                    Text="Add Password"
                    FontSize="16"
                    Clicked="OnShowAddView"
                    BackgroundColor="{AppThemeBinding Light=#007AFF, Dark=#0A84FF}"
                    TextColor="White"
                    Margin="16,4,16,12"
                    HeightRequest="44"
                    CornerRadius="10"
                    BorderWidth="0"/>

            <CollectionView Grid.Row="3"
                        ItemsSource="{Binding PasswordList}"
                        SelectedItem="{Binding SelectedPassword}"
                        SelectionMode="Single"
                        BackgroundColor="Transparent">

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid HeightRequest="50" Padding="16,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <Label Grid.Column="0"
                                   Text="{Binding Title}"
                                   FontSize="16"
                                   TextColor="{AppThemeBinding Light=#000000, Dark=#FFFFFF}"
                                   VerticalOptions="Center"
                                   Margin="0">
                                <Label.GestureRecognizers>
                                    <TapGestureRecognizer
                                            Tapped="OnShowDataView"
                                            CommandParameter="{Binding}"/>
                                </Label.GestureRecognizers>
                            </Label>

                            <HorizontalStackLayout Grid.Column="1" Spacing="8" VerticalOptions="Center">

                                <Label Text="{Binding RemainingTime}"
                                       IsVisible="{Binding IsDeleted}"
                                       TextColor="{AppThemeBinding Light=#FF3B30, Dark=#FF453A}"
                                       FontSize="12"
                                       VerticalOptions="Center"
                                       Margin="0,0,8,0"/>

                                <Button Text="Restore"
                                        IsVisible="{Binding IsDeleted}"
                                        Command="{Binding Source={x:Reference VaultViewRoot}, Path=RestoreCommand}"
                                        CommandParameter="{Binding}"
                                        BackgroundColor="{AppThemeBinding Light=#E5E5EA, Dark=#3A3A3C}"
                                        TextColor="{AppThemeBinding Light=#007AFF, Dark=#0A84FF}"
                                        FontSize="12"
                                        HeightRequest="30"
                                        Padding="10,0"
                                        CornerRadius="6"
                                        BorderWidth="0"/>

                                <Button Text="•••"
                                        BackgroundColor="Transparent"
                                        TextColor="{AppThemeBinding Light=#8E8E93, Dark=#8E8E93}"
                                        WidthRequest="40"
                                        HeightRequest="40"
                                        BorderWidth="0"
                                        FontSize="12">
                                    <FlyoutBase.ContextFlyout>
                                        <MenuFlyout>
                                            <MenuFlyoutItem 
                                                Text="{Binding DeleteActionText}"
                                                Command="{Binding Source={x:Reference VaultViewRoot}, Path=DeleteCommand}"
                                                CommandParameter="{Binding}"/>
                                        </MenuFlyout>
                                    </FlyoutBase.ContextFlyout>
                                </Button>
                            </HorizontalStackLayout>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical"/>
                </CollectionView.ItemsLayout>
            </CollectionView>

            <Button Grid.Row="4"
                    x:Name="TrashToggleBtn"
                    Text="Show Trash"
                    Clicked="OnToggleTrash"
                    BackgroundColor="Transparent"
                    TextColor="{AppThemeBinding Light=#8E8E93, Dark=#8E8E93}"
                    Margin="16,8,16,16"
                    HeightRequest="40"
                    BorderWidth="1"
                    BorderColor="{AppThemeBinding Light=#C6C6C8, Dark=#636366}"/>
        </Grid>

        <ContentView x:Name="DynamicContentView"
                Grid.Column="1"
                BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#000000}"
                Padding="20"/>
    </Grid>
</ContentView>